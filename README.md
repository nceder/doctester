== Doctester ==

This is a little project I came up with to help me in working on [[http://www.manning.com/ceder|//The Quick Python Book, 2nd Ed,// from Manning Publications]]. 

=== The Problem ===

 The problem I had in working on a Python language book was handling snippets of code intended to be printed in interactive shell format:

{{{
>>> print('Hello')
Hello
}}}

Not only did I need to make sure that all of the snippets from the first edition were updated to work correctly with Python 3.x, I also needed to be able to extract them into text files to be distributed with the book.  I wanted the code in the text itself (in MS Word files) to be the master code, and I needed to be able to verify it as I edited. Unfortunately, cutting and pasting samples printed with the shell prompt back into a shell doesn't really work, and my attempts at Word macros to extract the code from the normal text were not entirely reliable.

=== The Solution - abuse doctests ===

My solution was to treat the snippets (and their output) as doctests. Doctester is designed to run whatever is pasted into its code windows as a doctest and report on the results. It will also save the snippets into a text file and add headings. This wasn't perfect, but it meant that I could cut and paste snippets of code, test them and generate a text file all in one step. 

=== Disclaimers ===

As it is, doctester is fairly crude, and I make no promises as to its usefulness or correctness. It worked for me, but now that I've finished the book project, I probably won't do much more with it. However, if anyone else wants to make improvements, contact me at vceder <at> gmail.com for committer access.

== How to use doctester.py ==

doctester.py is written for Python 3.x and assumes an executable {{{python3}}} somewhere on the path. It also tests using Python 3.x but that can be changed by editing the value of {{{python_exe}}} at the top of the code. At the moment, doctester writes it test file file to a temporary file generated by the tempfile module and runs a doctest on that file, then deletes it. 


== Testing code snippets ===

To test a shell code snippet, copy the interactive shell commands (prompt and all) and the output, and paste into the 'Shell code' window. You can paste either by using Ctrl-v or but right clicking and choosing paste. Then use either the Test or Full Test buttons and the results (if any) will be in the results window. A full test will give verbose output from the doctest, while the plain test will not give any output if successful.

On bug is that if there was an error in running the test, there might also be no output in results window - this is something that could be improved. 

The plain code window can be used if you want to include code that isn't in interactive shell format - already defined functions, imports, etc. Doctester attempts to convert this code to shell format but prepending {{{>>> }}} and {{{... }}}. It is expected that any output from plain code will be reflected in the shell code window.

The screenshot below should give you some idea of how the windows interact, using the Full Test:
{{https://bytebucket.org/nceder/doctester/raw/1cf93fb0e1daacac0ae68ef68eff0db5238c864e/Screenshot-Python-tester.png?token=d30cf50d3e2ab30b5f8f42fadb70126b02465844|doc tester screenshot -
 https://bytebucket.org/nceder/doctester/raw/1cf93fb0e1daacac0ae68ef68eff0db5238c864e/Screenshot-Python-tester.png?token=d30cf50d3e2ab30b5f8f42fadb70126b02465844}}

=== Saving code snippets ===

doctester has Chapter and Header fields. The chapter field is used to create a filename for saving the source code (see the {{{ch_filename_template}}} variable in the source) and for creating a header for the saved snippet (see the {{{ch_header_template}}} variable). Each time you hit the 'save' button the current snippet and header is appended to the code file. 

For example, when I hit save on the code shown in the screenshot above, I got a file named {{{ch01_code.txt}}} which contains the following:

{{{
01.1 The print function

def hi(name):
    print('hello', name)

>>> def hello():
...     print('hello')
...
>>> hello()
hello
>>> hi('Vern')
hello Vern
}}}

=== Clearing windows ===

The 'Clear Results' button clears only the results window, which is handy if you are tinkering with the code to get the test to pass. The 'Clear All' button clears everything except the Chapter and Header.
